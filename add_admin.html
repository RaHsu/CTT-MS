<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加管理员</title>
    <link rel="stylesheet" href="css/iview.css">
    <style>
        form{
            margin-top: 30px;
        }
    </style>
</head>
<body>
<i-form :label-width="180" id="add_user_form" label-position="right">
    <form-item label="员工编号">
        <i-input v-model="formItem.username.value" placeholder="请输入员工编号"></i-input>
    </form-item>
    <form-item label="姓名">
        <i-input v-model="formItem.name.value" placeholder="请输入员工姓名"></i-input>
    </form-item>
    <form-item label="密码">
        <i-input v-model="formItem.password.value" placeholder="请输入密码" type="password"></i-input>
    </form-item>
    <form-item label="确认密码">
        <i-input v-model="formItem.confirm_password.value" placeholder="请确认密码" type="password"></i-input>
    </form-item>
    <form-item label="性别" prop="sex">
        <radio-group v-model="formItem.sex.value">
            <Radio label="男">男</Radio>
            <Radio label="女">女</Radio>
        </radio-group>
    </form-item>
    <form-item label="所在片区">
        <i-input v-model="formItem.area.value" placeholder="请输入所在片区"></i-input>
    </form-item>
    <form-item label="联系电话（选填）">
        <i-input v-model="formItem.phone.value" placeholder="请输入联系电话"></i-input>
    </form-item>
    <form-item label="QQ号码（选填）">
        <i-input v-model="formItem.qq.value" placeholder="请输入QQ号码"></i-input>
    </form-item>
    <form-item label="邮箱（选填）">
        <i-input v-model="formItem.email.value" placeholder="请输入邮箱"></i-input>
    </form-item>
    <form-item label="家庭住址（选填）">
        <i-input v-model="formItem.address.value" placeholder="请输入家庭住址"></i-input>
    </form-item>
    <form-item label="身份证号">
        <i-input v-model="formItem.idcard.value" placeholder="请输入身份证号"></i-input>
    </form-item>
    <form-item>
        <i-button type="primary" @click="upload(check(formItem),formItem)">提交</i-button>
    </form-item>
</i-form>
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/iview.js"></script>
<script src="js/common.js"></script>
<script src="js/check-input.js"></script>
<script src="js/url.js"></script>
<script>
    //待实现的功能：权限检查，表单检查
    var add_user_form = new Vue({
        el:'#add_user_form',
        data:{
            formItem: {
                username:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'员工编号不能为空'
                    }
                },
                name:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'用户名不能为空'
                    }
                },
                password:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'密码不能为空'
                    }
                },
                confirm_password:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'确认密码不能为空'
                    }
                },
                area:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'所在片区不能为空'
                    }
                },
                sex:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'性别不能为空'
                    }
                },
                phone:{
                    value:'',
                    check:[]
                },
                qq:{
                    value:'',
                    check:[]
                },
                email:{
                    value:'',
                    check:[]
                },
                address:{
                    value:'',
                    check:[]
                },
                idcard:{
                    value:'',
                    check:['empty'],
                    alertText: {
                        empty:'身份证号不能为空'
                    }
                }
            }
        },
        methods:{
            check:checkInput,
            upload:function (tof,data) {
                if(tof === true){

                    var send_data = extract_value(data);
                    console.log(send_with_cookie_data('json',send_data));
                    if(send_data.password !== send_data.confirm_password){
                        add_user_form.$Message.error("两次输入密码不相符");
                    }
                    else {
                        $.ajax({
                            url:server+url.add_user,
                            type : 'POST',
                            data : send_with_cookie_data('json',send_data),
                            //dataType:'json',
                            processData: false,
                            contentType: false,
                            crossDomain: true,
                            success:function (result) {
                                if(result.state === 'error'||result.state === 'warning'){
                                    add_user_form.$Message.error(result.message);
                                }else if(result.state === 'success'){
                                    add_user_form.$Message.success(result.message);

                                }
                                console.log(result);

                            },
                            error:function () {
                                alert('数据请求失败，请检查你的网络连接');
                            }
                        });
                    }

                }
            }
        }
    })
</script>
</body>
</html>